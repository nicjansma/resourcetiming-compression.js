!function(T){"use strict";var t,e;void 0!==T&&(e=(t=T).ResourceTimingCompression);var g={};function A(e,r,t){Array.prototype.forEach.call(e.ownerDocument.getElementsByTagName(t),function(t){e.href=t.currentSrc||t.src||t.getAttribute("xlink:href")||t.href,e.href.match(/^https?:\/\//)&&(r[e.href]=t)})}g.HOSTNAMES_REVERSED=!0,g.INITIATOR_TYPES={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7,beacon:8,fetch:9,iframe:"a",subdocument:"a",body:"b",input:"c",frame:"a",object:"d",video:"e",audio:"f",source:"g",track:"h",embed:"i",eventsource:"j",navigation:6},g.DEFAULT_XSS_BREAK_WORDS=[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],g.XSS_BREAK_DELIM="\n",g.DEFAULT_URL_LIMIT=500,g.SPECIAL_DATA_PREFIX="*",g.SPECIAL_DATA_DIMENSION_TYPE="0",g.SPECIAL_DATA_SIZE_TYPE="1",g.SPECIAL_DATA_SCRIPT_TYPE="2",g.SPECIAL_DATA_SCRIPT_ASYNC_ATTR=1,g.SPECIAL_DATA_SCRIPT_DEFER_ATTR=2,g.SPECIAL_DATA_SCRIPT_LOCAT_ATTR=4,g.SPECIAL_DATA_SERVERTIMING_TYPE="3",g.SPECIAL_DATA_LINK_ATTR_TYPE="4",g.SPECIAL_DATA_NAMESPACED_TYPE="5",g.SPECIAL_DATA_SERVICE_WORKER_TYPE="6",g.SPECIAL_DATA_PROTOCOL="7",g.REL_TYPES={prefetch:1,preload:2,prerender:3,stylesheet:4},g.HOSTNAME_REGEX=/^(https?:\/\/)([^/]+)(.*)/,g.trimUrls=[],g.xssBreakWords=g.DEFAULT_XSS_BREAK_WORDS,g.noConflict=function(){return t.ResourceTimingCompression=e,g},g.roundUpTiming=function(t){return"number"!=typeof t&&(t=0),Math.ceil(t||0)},g.convertToTrie=function(t){var e,r,n,i,o,a,s,c,d={};for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){for(r=e,n=0;n<this.xssBreakWords.length;n++)r=r.replace(this.xssBreakWords[n],"$1"+g.XSS_BREAK_DELIM+"$2");for(i=t[e],o=r.split(""),s=d,n=0;n<o.length;n++)void 0===(c=s[a=o[n]])?s=s[a]=n===o.length-1?i:{}:"string"==typeof c?s=s[a]={"|":c}:n===o.length-1?s[a]["|"]=i:s=s[a]}return d},g.optimizeTrie=function(t,e){var r,n,i,o=0,a=[];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&a.push(r);for(var s=0;s<a.length;s++)"object"==typeof t[r=a[s]]&&(n=this.optimizeTrie(t[r],!1))&&(delete t[r],r===g.XSS_BREAK_DELIM?(r=n.name,o++):r+=n.name,t[r]=n.value),o++;return 1===o?e?((i={})[r]=t[r],i):{name:r,value:t[r]}:!!e&&t},g.trimTiming=function(t,e){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0);var r=Math.round(t||0),n=Math.round(e||0);return 0===r?0:r-n},g.getNavStartTime=function(t){var e=0;if(!t)return e;try{t.location&&t.location.href,"performance"in t&&t.performance&&t.performance.timing&&t.performance.timing.navigationStart&&(e=t.performance.timing.navigationStart)}catch(t){}return e},g.findPerformanceEntriesForFrame=function(t,e,r,n){var i,o,a,s,c,d,u,m,S=[],p={},T={};if(void 0===e&&(e=!0),void 0===r&&(r=0),void 0===n&&(n=0),10<n)return S;try{if(o=this.getNavStartTime(t),A(m=t.document.createElement("a"),T,"script"),A(m,p,"link"),t.frames)for(g=0;g<t.frames.length;g++)s=o<(a=this.getNavStartTime(t.frames[g]))?r+(a-o):0,S=S.concat(this.findPerformanceEntriesForFrame(t.frames[g],!1,s,++n));try{if(t.location&&t.location.href,!("performance"in t&&t.performance&&t.performance.getEntriesByType))return S}catch(t){return S}e&&((i=t.performance.getEntriesByType("navigation"))&&1===i.length?(c=i[0],S.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:c.redirectStart,redirectEnd:c.redirectEnd,fetchStart:c.fetchStart,domainLookupStart:c.domainLookupStart,domainLookupEnd:c.domainLookupEnd,connectStart:c.connectStart,secureConnectionStart:c.secureConnectionStart,connectEnd:c.connectEnd,requestStart:c.requestStart,responseStart:c.responseStart,responseEnd:c.responseEnd,serverTiming:c.serverTiming||[],nextHopProtocol:c.nextHopProtocol})):t.performance.timing&&0!==(d=t.performance.timing).navigationStart&&d.responseEnd<=d.navigationStart+36e5&&S.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:d.redirectStart?d.redirectStart-d.navigationStart:0,redirectEnd:d.redirectEnd?d.redirectEnd-d.navigationStart:0,fetchStart:d.fetchStart?d.fetchStart-d.navigationStart:0,domainLookupStart:d.domainLookupStart?d.domainLookupStart-d.navigationStart:0,domainLookupEnd:d.domainLookupEnd?d.domainLookupEnd-d.navigationStart:0,connectStart:d.connectStart?d.connectStart-d.navigationStart:0,secureConnectionStart:d.secureConnectionStart?d.secureConnectionStart-d.navigationStart:0,connectEnd:d.connectEnd?d.connectEnd-d.navigationStart:0,requestStart:d.requestStart?d.requestStart-d.navigationStart:0,responseStart:d.responseStart?d.responseStart-d.navigationStart:0,responseEnd:d.responseEnd?d.responseEnd-d.navigationStart:0}));for(var f=t.performance.getEntriesByType("resource"),E=[],g=0;f&&g<f.length;g++)u={name:(d=f[g]).name,initiatorType:d.initiatorType,startTime:d.startTime+r,redirectStart:d.redirectStart?d.redirectStart+r:0,redirectEnd:d.redirectEnd?d.redirectEnd+r:0,fetchStart:d.fetchStart?d.fetchStart+r:0,domainLookupStart:d.domainLookupStart?d.domainLookupStart+r:0,domainLookupEnd:d.domainLookupEnd?d.domainLookupEnd+r:0,connectStart:d.connectStart?d.connectStart+r:0,secureConnectionStart:d.secureConnectionStart?d.secureConnectionStart+r:0,connectEnd:d.connectEnd?d.connectEnd+r:0,requestStart:d.requestStart?d.requestStart+r:0,responseStart:d.responseStart?d.responseStart+r:0,responseEnd:d.responseEnd?d.responseEnd+r:0,nextHopProtocol:d.nextHopProtocol},(d.encodedBodySize||d.decodedBodySize||d.transferSize)&&(u.encodedBodySize=d.encodedBodySize,u.decodedBodySize=d.decodedBodySize,u.transferSize=d.transferSize),d.serverTiming&&d.serverTiming.length&&(u.serverTiming=d.serverTiming),this.updateScriptFlags(T,d,u),this.updateLinkFlags(p,d,u),E.push(u);S=S.concat(E)}catch(t){return S}return S},g.updateScriptFlags=function(t,e,r){if(("script"===e.initiatorType||"link"===e.initiatorType)&&t[e.name]){var n=t[e.name];for(r.scriptAttrs=(n.async?g.SPECIAL_DATA_SCRIPT_ASYNC_ATTR:0)|(n.defer?g.SPECIAL_DATA_SCRIPT_DEFER_ATTR:0);1===n.nodeType&&"BODY"!==n.nodeName;)n=n.parentNode;r.scriptAttrs|="BODY"===n.nodeName?g.SPECIAL_DATA_SCRIPT_LOCAT_ATTR:0}},g.updateLinkFlags=function(t,e,r){"link"===e.initiatorType&&t[e.name]&&t[e.name].rel.split(/[\u0009\u000A\u000C\u000D\u0020]+/).find(function(t){return t=t.toLowerCase(),!!g.REL_TYPES[t]&&(r.linkAttrs=g.REL_TYPES[t],!0)})},g.toBase36=function(t){return"number"==typeof t&&0!==t?t.toString(36):"string"==typeof t?t:""},g.getVisibleEntries=function(t){if(!t)return{};var d={},u=t.document,m=u.createElement("A"),S=void 0!==t.pageXOffset?t.pageXOffset:(u.documentElement||u.body.parentNode||u.body).scrollLeft,p=void 0!==t.pageYOffset?t.pageYOffset:(u.documentElement||u.body.parentNode||u.body).scrollTop;return["img","iframe","image"].forEach(function(t){for(var e,r,n,i,o,a,s=u.getElementsByTagName(t),c=0;c<s.length;c++)if((e=s[c])&&(n=e.currentSrc||e.src||"function"==typeof e.getAttribute&&e.getAttribute("src")||e.getAttribute("xlink:href"),m.href=n,(n=m.href)&&!d[n]&&((r=e.getBoundingClientRect()).height||e.offsetHeight)&&(r.width||e.offsetWidth))){if(d[n]=[r.height||e.offsetHeight,r.width||e.offsetWidth,Math.round(r.top+p),Math.round(r.left+S)],!e.naturalHeight&&!e.naturalWidth)continue;e.currentSrc&&(e.srcset||e.parentNode&&e.parentNode.nodeName&&"PICTURE"===e.parentNode.nodeName.toUpperCase())?(i=e.isConnected?e.ownerDocument.createElement("IMG"):new T.Image).src=n:i=e,o=i.naturalHeight||e.naturalHeight,a=i.naturalWidth||e.naturalWidth,!o&&!a||d[n][0]===o&&d[n][1]===a||d[n].push(o,a)}}),d},g.inArray=function(t,e){var r;if(void 0===t||void 0===e||!e.length)return!1;for(r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},g.getFilteredResourceTiming=function(t,e,r,n){var i,o=this.findPerformanceEntriesForFrame(t,!0,0,0),a=this.getNavStartTime(t),s={};if(!o||!o.length)return{entries:[]};for(var c=[],d=0;d<o.length;d++)if(0!==(i=o[d]).name.indexOf("about:")&&0!==i.name.indexOf("javascript:")&&!(e&&a+i.startTime<e)){if(r&&a+i.startTime>r)break;(void 0===n||"*"===n||!n.length||i.initiatorType&&this.inArray(i.initiatorType,n))&&(g.accumulateServerTimingEntries(s,i.serverTiming),c.push(i))}var u=g.compressServerTiming(s);return{entries:c,serverTiming:{lookup:u,indexed:g.indexServerTiming(u)}}},g.compressSize=function(t){var e,r;return t.encodedBodySize||t.decodedBodySize||t.transferSize?(e=t.transferSize,[r=t.encodedBodySize,e?e-r:"_",t.decodedBodySize-r].map(this.toBase36).join(",").replace(/,+$/,"")):""},g.cleanupURL=function(t,e){var r;return t&&"[object Array]"!==Object.prototype.toString.call(t)?(void 0!==e&&t&&t.length>e&&(t=-1!==(r=t.indexOf("?"))&&r<e?t.substr(0,r)+"?...":t.substr(0,e-3)+"..."),t):""},g.trimUrl=function(t,e){var r,n,i;if(t&&e)for(r=0;r<e.length;r++)if("string"==typeof(i=e[r])){if(-1!==(n=t.indexOf(i))){t=t.substr(0,n+i.length)+"...";break}}else i instanceof RegExp&&i.test(t)&&(t=t.replace(i,"$1")+"...");return this.cleanupURL(t,g.DEFAULT_URL_LIMIT)},g.getResourceTiming=function(t,e,r,n){void 0===t&&(t=T);var i=g.getFilteredResourceTiming(t,e,r),o=i.entries,a=i.serverTiming;return o&&o.length?g.compressResourceTiming(t,o,a,n):{}},g.isCacheHit=function(t){return!(0<t.transferSize)&&(0<t.decodedBodySize||t.duration<30)},g.compressResourceTiming=function(t,e,i,r){var n,o,a,s,c,d,u={},m={};for(r||(m=this.getVisibleEntries(t)),n=0;n<e.length;n++){o=e[n],void 0===(a=this.INITIATOR_TYPES[o.initiatorType])&&(a=0),d=a+[this.trimTiming(o.startTime,0),this.trimTiming(o.responseEnd,o.startTime),this.trimTiming(o.responseStart,o.startTime),this.trimTiming(o.requestStart,o.startTime),this.trimTiming(o.connectEnd,o.startTime),this.trimTiming(o.secureConnectionStart,o.startTime),this.trimTiming(o.connectStart,o.startTime),this.trimTiming(o.domainLookupEnd,o.startTime),this.trimTiming(o.domainLookupStart,o.startTime),this.trimTiming(o.redirectEnd,o.startTime),this.trimTiming(o.redirectStart,o.startTime)].map(this.toBase36).join(",").replace(/,+$/,"");var S,p,T=this.compressSize(o);if(""!==T&&(d+=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_SIZE_TYPE+T),Object.prototype.hasOwnProperty.call(o,"scriptAttrs")&&(d+=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_SCRIPT_TYPE+o.scriptAttrs),Object.prototype.hasOwnProperty.call(o,"linkAttrs")&&(d+=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_LINK_ATTR_TYPE+o.linkAttrs),o.serverTiming&&o.serverTiming.length&&(d+=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_SERVERTIMING_TYPE+o.serverTiming.reduce(function(t,e,r){var n=String(e.duration);return"0."===n.substring(0,2)&&(n=n.substring(1)),t+=(0<r?",":"")+n+g.identifyServerTimingEntry(i.indexed[e.name].index,i.indexed[e.name].descriptions[e.description])},"")),o.workerStart&&"number"==typeof o.workerStart&&0!==o.workerStart&&(S=this.trimTiming(g.roundUpTiming(o.workerStart),o.startTime),p=this.trimTiming(g.roundUpTiming(o.fetchStart),o.startTime),d+=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_SERVICE_WORKER_TYPE+this.toBase36(S)+(p!==S?","+this.toBase36(p):"")),c=s=this.trimUrl(o.name,this.trimUrls),g.HOSTNAMES_REVERSED&&(c=this.reverseHostname(s)),Object.prototype.hasOwnProperty.call(o,"nextHopProtocol")&&""!==o.nextHopProtocol&&!g.isCacheHit(o)&&(d+=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_PROTOCOL+o.nextHopProtocol.replace("http/","h")),Object.prototype.hasOwnProperty.call(o,"_data")){var f="";for(var E in o._data)Object.prototype.hasOwnProperty.call(o._data,E)&&(f+=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_NAMESPACED_TYPE+E+":"+o._data[E]);void 0===u[s]?u[s]=d+f:u[s]+=f}else void 0!==u[c]?u[c]+="|"+d:void 0!==m[s]?u[c]=g.SPECIAL_DATA_PREFIX+g.SPECIAL_DATA_DIMENSION_TYPE+m[s].map(this.toBase36).join(",").replace(/,+$/,"")+"|"+d:u[c]=d}return{restiming:this.optimizeTrie(this.convertToTrie(u),!0),servertiming:i.lookup}},g.reverseHostname=function(t){return t.replace(g.HOSTNAME_REGEX,function(t,e,r,n){return e+g.reverseString(r)+n})},g.reverseString=function(t){for(var e=t.length,r="";e--;)r+=t[e];return r},g.accumulateServerTimingEntries=function(r,t){(t||[]).forEach(function(t){void 0===r[t.name]&&(r[t.name]={count:0,counts:{}});var e=r[t.name];e.counts[t.description]=e.counts[t.description]||0,e.counts[t.description]++,e.count++})},g.compressServerTiming=function(n){return Object.keys(n).sort(function(t,e){return n[e].count-n[t].count}).reduce(function(t,r){var e=Object.keys(n[r].counts).sort(function(t,e){return n[r].counts[e]-n[r].counts[t]});return t.push(1===e.length&&""===e[0]?r:[r].concat(e)),t},[])},g.indexServerTiming=function(t){return t.reduce(function(t,e,r){var n,i=Array.isArray(e)?(n=e[0],e.slice(1).reduce(function(t,e,r){return t[e]=r,t},{})):(n=e,{"":0});return t[n]={index:r,descriptions:i},t},{})},g.identifyServerTimingEntry=function(t,e){var r="";return t&&(r+=t),e&&(r+="."+e),r.length&&(r=":"+r),r},"function"==typeof define&&define.amd?define([],function(){return g}):"undefined"!=typeof module&&module.exports?module.exports=g:void 0!==t&&(t.ResourceTimingCompression=g)}("undefined"!=typeof window?window:void 0);