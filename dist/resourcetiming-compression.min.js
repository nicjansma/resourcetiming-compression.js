!function(T){"use strict";var t,e;void 0!==T&&(e=(t=T).ResourceTimingCompression);var i={HOSTNAMES_REVERSED:!0,INITIATOR_TYPES:{other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7,beacon:8,fetch:9,iframe:"a",subdocument:"a",body:"b",input:"c",frame:"a",object:"d",video:"e",audio:"f",source:"g",track:"h",embed:"i",eventsource:"j",navigation:6,"early-hints":"k",ping:"l",font:"m"},DEFAULT_XSS_BREAK_WORDS:[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],XSS_BREAK_DELIM:"\n",DEFAULT_URL_LIMIT:500,SPECIAL_DATA_PREFIX:"*",SPECIAL_DATA_DIMENSION_TYPE:"0",SPECIAL_DATA_SIZE_TYPE:"1",SPECIAL_DATA_SCRIPT_TYPE:"2",SPECIAL_DATA_SCRIPT_ASYNC_ATTR:1,SPECIAL_DATA_SCRIPT_DEFER_ATTR:2,SPECIAL_DATA_SCRIPT_LOCAT_ATTR:4,SPECIAL_DATA_SERVERTIMING_TYPE:"3",SPECIAL_DATA_LINK_ATTR_TYPE:"4",SPECIAL_DATA_NAMESPACED_TYPE:"5",SPECIAL_DATA_SERVICE_WORKER_TYPE:"6",SPECIAL_DATA_PROTOCOL:"7",SPECIAL_DATA_CONTENT_TYPE:"8",SPECIAL_DATA_DELIVERY_TYPE:"9",SPECIAL_DATA_RENDER_BLOCKING_STATUS:"a",SPECIAL_DATA_RESPONSE_STATUS:"b",REL_TYPES:{prefetch:1,preload:2,prerender:3,stylesheet:4},HOSTNAME_REGEX:/^(https?:\/\/)([^/]+)(.*)/,trimUrls:[]};i.xssBreakWords=i.DEFAULT_XSS_BREAK_WORDS,i.contentTypeMap={next:15,pre:15,vals:{"application/json":0,"application/xml":1,"font/woff":2,"font/woff2":3,"image/avif":4,"image/gif":5,"image/jpeg":6,"image/png":7,"image/svg+xml":8,"image/webp":9,"image/x-icon":10,"text/css":11,"text/html":12,"text/javascript":13,"text/plain":14}},i.deliveryTypeMap={next:2,pre:2,vals:{cache:0,"navigational-prefetch":1}},i.nextHopProtocolMap={next:6,pre:6,vals:{h2:0,"h0.9":1,"h1.0":2,"h1.1":3,h2c:4,h3:5}},i.noConflict=function(){return t.ResourceTimingCompression=e,i},i.roundUpTiming=function(t){return"number"!=typeof t&&(t=0),Math.ceil(t||0)},i.convertToTrie=function(t){var e,r,n,i,o,a,s,c,p={};for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){for(r=e,n=0;n<this.xssBreakWords.length;n++)r=r.replace(this.xssBreakWords[n],"$1"+this.XSS_BREAK_DELIM+"$2");for(i=t[e],o=r.split(""),s=p,n=0;n<o.length;n++)void 0===(c=s[a=o[n]])?s=s[a]=n===o.length-1?i:{}:"string"==typeof c?s=s[a]={"|":c}:n===o.length-1?s[a]["|"]=i:s=s[a]}return p},i.optimizeTrie=function(t,e){var r,n,i,o=0,a=[];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&a.push(r);for(var s=0;s<a.length;s++)"object"==typeof t[r=a[s]]&&(n=this.optimizeTrie(t[r],!1))&&(delete t[r],r===this.XSS_BREAK_DELIM?(r=n.name,o++):r+=n.name,t[r]=n.value),o++;return 1===o?e?((i={})[r]=t[r],i):{name:r,value:t[r]}:!!e&&t},i.trimTiming=function(t,e){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0);var r=Math.round(t||0),n=Math.round(e||0);return 0===r?0:r-n},i.getNavStartTime=function(t){var e=0;if(!t)return e;try{t.location&&t.location.href,"performance"in t&&t.performance&&t.performance.timing&&t.performance.timing.navigationStart&&(e=t.performance.timing.navigationStart)}catch(t){}return e},i.findPerformanceEntriesForFrame=function(t,e,r,n){var i,o,a,s,c,p,d,u,S=[],m={},T={};if(void 0===e&&(e=!0),void 0===r&&(r=0),void 0===n&&(n=0),10<n)return S;try{if(o=this.getNavStartTime(t),u=t.document.createElement("a"),this.collectResources(u,T,"script"),this.collectResources(u,m,"link"),t.frames)for(f=0;f<t.frames.length;f++)s=o<(a=this.getNavStartTime(t.frames[f]))?r+(a-o):0,S=S.concat(this.findPerformanceEntriesForFrame(t.frames[f],!1,s,++n));try{if(t.location&&t.location.href,!("performance"in t&&t.performance&&t.performance.getEntriesByType))return S}catch(t){return S}e&&((i=t.performance.getEntriesByType("navigation"))&&1===i.length?(c=i[0],S.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:c.redirectStart,redirectEnd:c.redirectEnd,fetchStart:c.fetchStart,domainLookupStart:c.domainLookupStart,domainLookupEnd:c.domainLookupEnd,connectStart:c.connectStart,secureConnectionStart:c.secureConnectionStart,connectEnd:c.connectEnd,requestStart:c.requestStart,responseStart:c.responseStart,responseEnd:c.responseEnd,serverTiming:c.serverTiming||[],nextHopProtocol:c.nextHopProtocol})):t.performance.timing&&0!==(p=t.performance.timing).navigationStart&&p.responseEnd<=p.navigationStart+36e5&&S.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:p.redirectStart?p.redirectStart-p.navigationStart:0,redirectEnd:p.redirectEnd?p.redirectEnd-p.navigationStart:0,fetchStart:p.fetchStart?p.fetchStart-p.navigationStart:0,domainLookupStart:p.domainLookupStart?p.domainLookupStart-p.navigationStart:0,domainLookupEnd:p.domainLookupEnd?p.domainLookupEnd-p.navigationStart:0,connectStart:p.connectStart?p.connectStart-p.navigationStart:0,secureConnectionStart:p.secureConnectionStart?p.secureConnectionStart-p.navigationStart:0,connectEnd:p.connectEnd?p.connectEnd-p.navigationStart:0,requestStart:p.requestStart?p.requestStart-p.navigationStart:0,responseStart:p.responseStart?p.responseStart-p.navigationStart:0,responseEnd:p.responseEnd?p.responseEnd-p.navigationStart:0}));for(var h=t.performance.getEntriesByType("resource"),E=[],f=0;h&&f<h.length;f++)d={name:(p=h[f]).name,initiatorType:p.initiatorType,startTime:p.startTime+r,redirectStart:p.redirectStart?p.redirectStart+r:0,redirectEnd:p.redirectEnd?p.redirectEnd+r:0,fetchStart:p.fetchStart?p.fetchStart+r:0,domainLookupStart:p.domainLookupStart?p.domainLookupStart+r:0,domainLookupEnd:p.domainLookupEnd?p.domainLookupEnd+r:0,connectStart:p.connectStart?p.connectStart+r:0,secureConnectionStart:p.secureConnectionStart?p.secureConnectionStart+r:0,connectEnd:p.connectEnd?p.connectEnd+r:0,requestStart:p.requestStart?p.requestStart+r:0,responseStart:p.responseStart?p.responseStart+r:0,responseEnd:p.responseEnd?p.responseEnd+r:0,nextHopProtocol:p.nextHopProtocol},(p.encodedBodySize||p.decodedBodySize||p.transferSize)&&(d.encodedBodySize=p.encodedBodySize,d.decodedBodySize=p.decodedBodySize,d.transferSize=p.transferSize),p.serverTiming&&p.serverTiming.length&&(d.serverTiming=p.serverTiming),this.updateScriptFlags(T,p,d),this.updateLinkFlags(m,p,d),E.push(d);S=S.concat(E)}catch(t){return S}return S},i.updateScriptFlags=function(t,e,r){if(("script"===e.initiatorType||"link"===e.initiatorType)&&t[e.name]){var n=t[e.name];for(r.scriptAttrs=(n.async?this.SPECIAL_DATA_SCRIPT_ASYNC_ATTR:0)|(n.defer?this.SPECIAL_DATA_SCRIPT_DEFER_ATTR:0);1===n.nodeType&&"BODY"!==n.nodeName;)n=n.parentNode;r.scriptAttrs|="BODY"===n.nodeName?this.SPECIAL_DATA_SCRIPT_LOCAT_ATTR:0}},i.updateLinkFlags=function(t,e,r){"link"===e.initiatorType&&t[e.name]&&t[e.name].rel.split(/[\u0009\u000A\u000C\u000D\u0020]+/).find(function(t){return t=t.toLowerCase(),!!i.REL_TYPES[t]&&(r.linkAttrs=i.REL_TYPES[t],!0)})},i.toBase36=function(t){return"number"==typeof t&&0!==t?t.toString(36):"string"==typeof t?t:""},i.collectResources=function(e,r,t){Array.prototype.forEach.call(e.ownerDocument.getElementsByTagName(t),function(t){e.href=t.currentSrc||t.src||t.getAttribute("xlink:href")||t.href,e.href.match(/^https?:\/\//)&&(r[e.href]=t)})},i.getVisibleEntries=function(t){if(!t)return{};var p={},d=t.document,u=d.createElement("A"),S=void 0!==t.pageXOffset?t.pageXOffset:(d.documentElement||d.body.parentNode||d.body).scrollLeft,m=void 0!==t.pageYOffset?t.pageYOffset:(d.documentElement||d.body.parentNode||d.body).scrollTop;return["img","iframe","image"].forEach(function(t){for(var e,r,n,i,o,a,s=d.getElementsByTagName(t),c=0;c<s.length;c++)if((e=s[c])&&(n=e.currentSrc||e.src||"function"==typeof e.getAttribute&&e.getAttribute("src")||e.getAttribute("xlink:href"),u.href=n,(n=u.href)&&!p[n]&&((r=e.getBoundingClientRect()).height||e.offsetHeight)&&(r.width||e.offsetWidth))){if(p[n]=[r.height||e.offsetHeight,r.width||e.offsetWidth,Math.round(r.top+m),Math.round(r.left+S)],!e.naturalHeight&&!e.naturalWidth)continue;e.currentSrc&&(e.srcset||e.parentNode&&e.parentNode.nodeName&&"PICTURE"===e.parentNode.nodeName.toUpperCase())?(i=e.isConnected?e.ownerDocument.createElement("IMG"):new T.Image).src=n:i=e,o=i.naturalHeight||e.naturalHeight,a=i.naturalWidth||e.naturalWidth,!o&&!a||p[n][0]===o&&p[n][1]===a||p[n].push(o,a)}}),p},i.inArray=function(t,e){var r;if(void 0===t||void 0===e||!e.length)return!1;for(r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},i.getFilteredResourceTiming=function(t,e,r,n){var i,o=this.findPerformanceEntriesForFrame(t,!0,0,0),a=this.getNavStartTime(t),s={};if(!o||!o.length)return{entries:[]};for(var c=[],p=0;p<o.length;p++)if(0!==(i=o[p]).name.indexOf("about:")&&0!==i.name.indexOf("javascript:")&&!(e&&a+i.startTime<e)){if(r&&a+i.startTime>r)break;(void 0===n||"*"===n||!n.length||i.initiatorType&&this.inArray(i.initiatorType,n))&&(this.accumulateServerTimingEntries(s,i.serverTiming),c.push(i))}var d=this.compressServerTiming(s);return{entries:c,serverTiming:{lookup:d,indexed:this.indexServerTiming(d)}}},i.compressSize=function(t){var e,r;return t.encodedBodySize||t.decodedBodySize||t.transferSize?(e=t.transferSize,[r=t.encodedBodySize,e?e-r:"_",t.decodedBodySize-r].map(this.toBase36).join(",").replace(/,+$/,"")):""},i.cleanupURL=function(t,e){var r;return t&&"[object Array]"!==Object.prototype.toString.call(t)?(void 0!==e&&t&&t.length>e&&(t=-1!==(r=t.indexOf("?"))&&r<e?t.substr(0,r)+"?...":t.substr(0,e-3)+"..."),t):""},i.trimUrl=function(t,e){var r,n,i;if(t&&e)for(r=0;r<e.length;r++)if("string"==typeof(i=e[r])){if(-1!==(n=t.indexOf(i))){t=t.substr(0,n+i.length)+"...";break}}else i instanceof RegExp&&i.test(t)&&(t=t.replace(i,"$1")+"...");return this.cleanupURL(t,this.DEFAULT_URL_LIMIT)},i.getResourceTiming=function(t,e,r,n){void 0===t&&(t=T);var i=this.getFilteredResourceTiming(t,e,r),o=i.entries,a=i.serverTiming;return o&&o.length?this.compressResourceTiming(t,o,a,n):{}},i.isCacheHit=function(t){return!(0<t.transferSize)&&(0<t.decodedBodySize||t.duration<30)},i.getValueMapFor=function(t,e){return void 0===t.vals[e]?(t.vals[e]=t.next,(t.next++).toString(36)):0===t.vals[e]?"":t.vals[e].toString(36)},i.getValuesMapForBeacon=function(t){var e=[],r=t.pre;for(var n in t.vals)0<r--||e.push(n);return e},i.compressResourceTiming=function(t,e,i,r){var n,o,a,s,c,p,d={},u={};for(r||(u=this.getVisibleEntries(t)),n=0;n<e.length;n++){o=e[n],void 0===(a=this.INITIATOR_TYPES[o.initiatorType])&&(a=0),p=a+[this.trimTiming(o.startTime,0),this.trimTiming(o.responseEnd,o.startTime),this.trimTiming(o.responseStart,o.startTime),this.trimTiming(o.requestStart,o.startTime),this.trimTiming(o.connectEnd,o.startTime),this.trimTiming(o.secureConnectionStart,o.startTime),this.trimTiming(o.connectStart,o.startTime),this.trimTiming(o.domainLookupEnd,o.startTime),this.trimTiming(o.domainLookupStart,o.startTime),this.trimTiming(o.redirectEnd,o.startTime),this.trimTiming(o.redirectStart,o.startTime)].map(this.toBase36).join(",").replace(/,+$/,"");var S,m,T=this.compressSize(o);if(""!==T&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_SIZE_TYPE+T),Object.prototype.hasOwnProperty.call(o,"scriptAttrs")&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_SCRIPT_TYPE+o.scriptAttrs),Object.prototype.hasOwnProperty.call(o,"linkAttrs")&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_LINK_ATTR_TYPE+o.linkAttrs),o.serverTiming&&o.serverTiming.length&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_SERVERTIMING_TYPE+o.serverTiming.reduce(function(t,e,r){var n=String(e.duration);return"0."===n.substring(0,2)&&(n=n.substring(1)),t+=(0<r?",":"")+n+this.identifyServerTimingEntry(i.indexed[e.name].index,i.indexed[e.name].descriptions[e.description])},"")),o.workerStart&&"number"==typeof o.workerStart&&0!==o.workerStart&&(S=this.trimTiming(this.roundUpTiming(o.workerStart),o.startTime),m=this.trimTiming(this.roundUpTiming(o.fetchStart),o.startTime),p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_SERVICE_WORKER_TYPE+this.toBase36(S)+(m!==S?(","+this.toBase36(m)).replace(/,+$/,""):"")),c=s=this.trimUrl(o.name,this.trimUrls),this.HOSTNAMES_REVERSED&&(c=this.reverseHostname(s)),Object.prototype.hasOwnProperty.call(o,"nextHopProtocol")&&""!==o.nextHopProtocol&&!this.isCacheHit(o)&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_PROTOCOL+this.getValueMapFor(this.nextHopProtocolMap,o.nextHopProtocol.replace("http/","h"))),Object.prototype.hasOwnProperty.call(o,"contentType")&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_CONTENT_TYPE+this.getValueMapFor(this.contentTypeMap,o.contentType)),Object.prototype.hasOwnProperty.call(o,"deliveryType")&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_DELIVERY_TYPE+this.getValueMapFor(this.deliveryTypeMap,o.deliveryType)),Object.prototype.hasOwnProperty.call(o,"renderBlockingStatus")&&"blocking"===o.renderBlockingStatus&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_RENDER_BLOCKING_STATUS),o.hasOwnProperty("responseStatus")&&200!==o.responseStatus&&(p+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_RESPONSE_STATUS+this.toBase36(o.responseStatus)),Object.prototype.hasOwnProperty.call(o,"_data")){var h="";for(var E in o._data)Object.prototype.hasOwnProperty.call(o._data,E)&&(h+=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_NAMESPACED_TYPE+E+":"+o._data[E]);void 0===d[s]?d[s]=p+h:d[s]+=h}else void 0!==d[c]?d[c]+="|"+p:void 0!==u[s]?d[c]=this.SPECIAL_DATA_PREFIX+this.SPECIAL_DATA_DIMENSION_TYPE+u[s].map(this.toBase36).join(",").replace(/,+$/,"")+"|"+p:d[c]=p}return{restiming:this.optimizeTrie(this.convertToTrie(d),!0),servertiming:i.lookup}},i.reverseHostname=function(t){return t.replace(this.HOSTNAME_REGEX,function(t,e,r,n){return e+i.reverseString(r)+n})},i.reverseString=function(t){for(var e=t.length,r="";e--;)r+=t[e];return r},i.accumulateServerTimingEntries=function(r,t){(t||[]).forEach(function(t){void 0===r[t.name]&&(r[t.name]={count:0,counts:{}});var e=r[t.name];e.counts[t.description]=e.counts[t.description]||0,e.counts[t.description]++,e.count++})},i.compressServerTiming=function(n){return Object.keys(n).sort(function(t,e){return n[e].count-n[t].count}).reduce(function(t,r){var e=Object.keys(n[r].counts).sort(function(t,e){return n[r].counts[e]-n[r].counts[t]});return t.push(1===e.length&&""===e[0]?r:[r].concat(e)),t},[])},i.indexServerTiming=function(t){return t.reduce(function(t,e,r){var n,i=Array.isArray(e)?(n=e[0],e.slice(1).reduce(function(t,e,r){return t[e]=r,t},{})):(n=e,{"":0});return t[n]={index:r,descriptions:i},t},{})},i.identifyServerTimingEntry=function(t,e){var r="";return t&&(r+=t),e&&(r+="."+e),r.length&&(r=":"+r),r},"function"==typeof define&&define.amd?define([],function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:void 0!==t&&(t.ResourceTimingCompression=i)}("undefined"!=typeof window?window:void 0);