!function(t){"use strict";function e(t,e,r){Array.prototype.forEach.call(t.ownerDocument.getElementsByTagName(r),function(r){t.href=r.currentSrc||r.src||r.getAttribute("xlink:href")||r.href,t.href.match(/^https?:\/\//)&&(e[t.href]=r)})}var r,n;void 0!==t&&(r=t,n=r.ResourceTimingCompression);var i={};i.HOSTNAMES_REVERSED=!0,i.INITIATOR_TYPES={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7,beacon:8,fetch:9,iframe:"a",subdocument:"a"},i.DEFAULT_XSS_BREAK_WORDS=[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],i.XSS_BREAK_DELIM="\n",i.DEFAULT_URL_LIMIT=500,i.SPECIAL_DATA_PREFIX="*",i.SPECIAL_DATA_DIMENSION_TYPE="0",i.SPECIAL_DATA_SIZE_TYPE="1",i.SPECIAL_DATA_SCRIPT_TYPE="2",i.SPECIAL_DATA_SCRIPT_ASYNC_ATTR=1,i.SPECIAL_DATA_SCRIPT_DEFER_ATTR=2,i.SPECIAL_DATA_SCRIPT_LOCAT_ATTR=4,i.SPECIAL_DATA_SERVERTIMING_TYPE="3",i.SPECIAL_DATA_LINK_ATTR_TYPE="4",i.REL_TYPES={prefetch:1,preload:2,prerender:3,stylesheet:4},i.HOSTNAME_REGEX=/^(https?:\/\/)([^\/]+)(.*)/,i.trimUrls=[],i.xssBreakWords=i.DEFAULT_XSS_BREAK_WORDS,i.noConflict=function(){return r.ResourceTimingCompression=n,i},i.convertToTrie=function(t){var e,r,n,o,a,s,c,d,u={};for(e in t)if(t.hasOwnProperty(e)){for(r=e,n=0;n<this.xssBreakWords.length;n++)r=r.replace(this.xssBreakWords[n],"$1"+i.XSS_BREAK_DELIM+"$2");for(o=t[e],a=r.split(""),c=u,n=0;n<a.length;n++)s=a[n],d=c[s],void 0===d?c=c[s]=n===a.length-1?o:{}:"string"==typeof d?c=c[s]={"|":d}:n===a.length-1?c[s]["|"]=o:c=c[s]}return u},i.optimizeTrie=function(t,e){var r,n,o,a=0,s=[];for(r in t)t.hasOwnProperty(r)&&s.push(r);for(var c=0;c<s.length;c++)r=s[c],"object"==typeof t[r]&&(n=this.optimizeTrie(t[r],!1))&&(delete t[r],r===i.XSS_BREAK_DELIM?(r=n.name,a++):r+=n.name,t[r]=n.value),a++;return 1===a?e?(o={},o[r]=t[r],o):{name:r,value:t[r]}:!!e&&t},i.trimTiming=function(t,e){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0);var r=Math.round(t||0),n=Math.round(e||0);return 0===r?0:r-n},i.getNavStartTime=function(t){var e=0;if(!t)return e;try{t.location&&t.location.href,"performance"in t&&t.performance&&t.performance.timing&&t.performance.timing.navigationStart&&(e=t.performance.timing.navigationStart)}catch(t){}return e},i.findPerformanceEntriesForFrame=function(t,r,n,i){var o,a,s,c,d,u,m,S,f,T=[],p={},E={};if(void 0===r&&(r=!0),void 0===n&&(n=0),void 0===i&&(i=0),i>10)return T;try{if(s=this.getNavStartTime(t),f=t.document.createElement("a"),e(f,E,"script"),e(f,p,"link"),t.frames)for(o=0;o<t.frames.length;o++)c=this.getNavStartTime(t.frames[o]),d=0,c>s&&(d=n+(c-s)),T=T.concat(this.findPerformanceEntriesForFrame(t.frames[o],!1,d,++i));try{if(t.location&&t.location.href,!("performance"in t&&t.performance&&t.performance.getEntriesByType))return T}catch(t){return T}r&&(a=t.performance.getEntriesByType("navigation"),a&&1===a.length?(u=a[0],T.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:u.redirectStart,redirectEnd:u.redirectEnd,fetchStart:u.fetchStart,domainLookupStart:u.domainLookupStart,domainLookupEnd:u.domainLookupEnd,connectStart:u.connectStart,secureConnectionStart:u.secureConnectionStart,connectEnd:u.connectEnd,requestStart:u.requestStart,responseStart:u.responseStart,responseEnd:u.responseEnd,serverTiming:u.serverTiming||[]})):t.performance.timing&&(m=t.performance.timing,0!==m.navigationStart&&m.responseEnd<=m.navigationStart+36e5&&T.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:m.redirectStart?m.redirectStart-m.navigationStart:0,redirectEnd:m.redirectEnd?m.redirectEnd-m.navigationStart:0,fetchStart:m.fetchStart?m.fetchStart-m.navigationStart:0,domainLookupStart:m.domainLookupStart?m.domainLookupStart-m.navigationStart:0,domainLookupEnd:m.domainLookupEnd?m.domainLookupEnd-m.navigationStart:0,connectStart:m.connectStart?m.connectStart-m.navigationStart:0,secureConnectionStart:m.secureConnectionStart?m.secureConnectionStart-m.navigationStart:0,connectEnd:m.connectEnd?m.connectEnd-m.navigationStart:0,requestStart:m.requestStart?m.requestStart-m.navigationStart:0,responseStart:m.responseStart?m.responseStart-m.navigationStart:0,responseEnd:m.responseEnd?m.responseEnd-m.navigationStart:0})));var g=t.performance.getEntriesByType("resource"),h=[];for(o=0;g&&o<g.length;o++)m=g[o],S={name:m.name,initiatorType:m.initiatorType,startTime:m.startTime+n,redirectStart:m.redirectStart?m.redirectStart+n:0,redirectEnd:m.redirectEnd?m.redirectEnd+n:0,fetchStart:m.fetchStart?m.fetchStart+n:0,domainLookupStart:m.domainLookupStart?m.domainLookupStart+n:0,domainLookupEnd:m.domainLookupEnd?m.domainLookupEnd+n:0,connectStart:m.connectStart?m.connectStart+n:0,secureConnectionStart:m.secureConnectionStart?m.secureConnectionStart+n:0,connectEnd:m.connectEnd?m.connectEnd+n:0,requestStart:m.requestStart?m.requestStart+n:0,responseStart:m.responseStart?m.responseStart+n:0,responseEnd:m.responseEnd?m.responseEnd+n:0},(m.encodedBodySize||m.decodedBodySize||m.transferSize)&&(S.encodedBodySize=m.encodedBodySize,S.decodedBodySize=m.decodedBodySize,S.transferSize=m.transferSize),m.serverTiming&&m.serverTiming.length&&(S.serverTiming=m.serverTiming),this.updateScriptFlags(E,m,S),this.updateLinkFlags(p,m,S),h.push(S);T=T.concat(h)}catch(t){return T}return T},i.updateScriptFlags=function(t,e,r){if(("script"===e.initiatorType||"link"===e.initiatorType)&&t[e.name]){var n=t[e.name];for(r.scriptAttrs=(n.async?i.SPECIAL_DATA_SCRIPT_ASYNC_ATTR:0)|(n.defer?i.SPECIAL_DATA_SCRIPT_DEFER_ATTR:0);1===n.nodeType&&"BODY"!==n.nodeName;)n=n.parentNode;r.scriptAttrs|="BODY"===n.nodeName?i.SPECIAL_DATA_SCRIPT_LOCAT_ATTR:0}},i.updateLinkFlags=function(t,e,r){"link"===e.initiatorType&&t[e.name]&&t[e.name].rel.split(/[\u0009\u000A\u000C\u000D\u0020]+/).find(function(t){return t=t.toLowerCase(),!!i.REL_TYPES[t]&&(r.linkAttrs=i.REL_TYPES[t],!0)})},i.toBase36=function(t){return"number"==typeof t&&0!==t?t.toString(36):"string"==typeof t?t:""},i.getVisibleEntries=function(t){if(!t)return{};var e,r,n=["img","iframe","image"],i={},o=t.document,a=o.createElement("A");return e=void 0!==t.pageXOffset?t.pageXOffset:(o.documentElement||o.body.parentNode||o.body).scrollLeft,r=void 0!==t.pageYOffset?t.pageYOffset:(o.documentElement||o.body.parentNode||o.body).scrollTop,n.forEach(function(t){var n,s,c,d,u=o.getElementsByTagName(t);for(s=0;s<u.length;s++)if((n=u[s])&&(d=n.currentSrc||n.src||n.getAttribute("src")||n.getAttribute("xlink:href"),a.href=d,(d=a.href)&&!i[d]&&(c=n.getBoundingClientRect(),(c.height||n.offsetHeight)&&(c.width||n.offsetWidth)))){i[d]=[c.height||n.offsetHeight,c.width||n.offsetWidth,Math.round(c.top+r),Math.round(c.left+e)];var m=new Image;m.onload=function(){!m.naturalHeight&&!m.naturalWidth||i[d][0]===m.naturalHeight&&i[d][1]===m.naturalWidth||i[d].push(m.naturalHeight,m.naturalWidth)},m.src=n.src}}),i},i.inArray=function(t,e){var r;if(void 0===t||void 0===e||!e.length)return!1;for(r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},i.getFilteredResourceTiming=function(t,e,r,n){var o,a,s=this.findPerformanceEntriesForFrame(t,!0,0,0),c=this.getNavStartTime(t),d={};if(!s||!s.length)return{entries:[]};var u=[];for(o=0;o<s.length;o++)if(a=s[o],0!==a.name.indexOf("about:")&&0!==a.name.indexOf("javascript:")&&!(e&&c+a.startTime<e)){if(r&&c+a.startTime>r)break;(void 0===n||"*"===n||!n.length||a.initiatorType&&this.inArray(a.initiatorType,n))&&(i.accumulateServerTimingEntries(d,a.serverTiming),u.push(a))}var m=i.compressServerTiming(d);return{entries:u,serverTiming:{lookup:m,indexed:i.indexServerTiming(m)}}},i.compressSize=function(t){var e,r,n,i;return t.encodedBodySize||t.decodedBodySize||t.transferSize?(e=t.transferSize,r=t.encodedBodySize,n=t.decodedBodySize,i=[r,e?e-r:"_",n-r],i.map(this.toBase36).join(",").replace(/,+$/,"")):""},i.cleanupURL=function(t,e){var r;return t&&"[object Array]"!==Object.prototype.toString.call(t)?(void 0!==e&&t&&t.length>e&&(r=t.indexOf("?"),t=-1!==r&&r<e?t.substr(0,r)+"?...":t.substr(0,e-3)+"..."),t):""},i.trimUrl=function(t,e){var r,n,o;if(t&&e)for(r=0;r<e.length;r++)if("string"==typeof(o=e[r])){if(-1!==(n=t.indexOf(o))){t=t.substr(0,n+o.length)+"...";break}}else o instanceof RegExp&&o.test(t)&&(t=t.replace(o,"$1")+"...");return this.cleanupURL(t,i.DEFAULT_URL_LIMIT)},i.getResourceTiming=function(e,r,n){void 0===e&&(e=t);var o=i.getFilteredResourceTiming(e,r,n),a=o.entries,s=o.serverTiming;return a&&a.length?i.compressResourceTiming(e,a,s):{}},i.compressResourceTiming=function(t,e,r){var n,o,a,s,c,d={},u={};for(u=this.getVisibleEntries(t),n=0;n<e.length;n++){o=e[n],a=this.INITIATOR_TYPES[o.initiatorType],void 0===a&&(a=0),c=a+[this.trimTiming(o.startTime,0),this.trimTiming(o.responseEnd,o.startTime),this.trimTiming(o.responseStart,o.startTime),this.trimTiming(o.requestStart,o.startTime),this.trimTiming(o.connectEnd,o.startTime),this.trimTiming(o.secureConnectionStart,o.startTime),this.trimTiming(o.connectStart,o.startTime),this.trimTiming(o.domainLookupEnd,o.startTime),this.trimTiming(o.domainLookupStart,o.startTime),this.trimTiming(o.redirectEnd,o.startTime),this.trimTiming(o.redirectStart,o.startTime)].map(this.toBase36).join(",").replace(/,+$/,"");var m=this.compressSize(o);""!==m&&(c+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_SIZE_TYPE+m),o.hasOwnProperty("scriptAttrs")&&(c+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_SCRIPT_TYPE+o.scriptAttrs),o.hasOwnProperty("linkAttrs")&&(c+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_LINK_ATTR_TYPE+o.linkAttrs),o.serverTiming&&o.serverTiming.length&&(c+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_SERVERTIMING_TYPE+o.serverTiming.reduce(function(t,e,n){var o=String(e.duration);"0."===o.substring(0,2)&&(o=o.substring(1));var a=i.identifyServerTimingEntry(r.indexed[e.name].index,r.indexed[e.name].descriptions[e.description]);return t+=(n>0?",":"")+o+a},"")),s=this.trimUrl(o.name,this.trimUrls),i.HOSTNAMES_REVERSED&&(s=this.reverseHostname(s)),void 0!==d[s]?d[s]+="|"+c:void 0!==u[s]?d[s]=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_DIMENSION_TYPE+u[s].map(this.toBase36).join(",").replace(/,+$/,"")+"|"+c:d[s]=c}return{restiming:this.optimizeTrie(this.convertToTrie(d),!0),servertiming:r.lookup}},i.reverseHostname=function(t){return t.replace(i.HOSTNAME_REGEX,function(t,e,r,n){return e+i.reverseString(r)+n})},i.reverseString=function(t){for(var e=t.length,r="";e--;)r+=t[e];return r},i.accumulateServerTimingEntries=function(t,e){(e||[]).forEach(function(e){void 0===t[e.name]&&(t[e.name]={count:0,counts:{}});var r=t[e.name];r.counts[e.description]=r.counts[e.description]||0,r.counts[e.description]++,r.count++})},i.compressServerTiming=function(t){return Object.keys(t).sort(function(e,r){return t[r].count-t[e].count}).reduce(function(e,r){var n=Object.keys(t[r].counts).sort(function(e,n){return t[r].counts[n]-t[r].counts[e]});return e.push(1===n.length&&""===n[0]?r:[r].concat(n)),e},[])},i.indexServerTiming=function(t){return t.reduce(function(t,e,r){var n,i;return Array.isArray(e)?(n=e[0],i=e.slice(1).reduce(function(t,e,r){return t[e]=r,t},{})):(n=e,i={"":0}),t[n]={index:r,descriptions:i},t},{})},i.identifyServerTimingEntry=function(t,e){var r="";return t&&(r+=t),e&&(r+="."+e),r.length&&(r=":"+r),r},"function"==typeof define&&define.amd?define([],function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:void 0!==r&&(r.ResourceTimingCompression=i)}("undefined"!=typeof window?window:void 0);