!function(e){"use strict";function t(e,t,r){Array.prototype.forEach.call(e.ownerDocument.getElementsByTagName(r),function(r){e.href=r.currentSrc||r.src||r.getAttribute("xlink:href")||r.href,e.href.match(/^https?:\/\//)&&(t[e.href]=r)})}var r,n;"undefined"!=typeof e&&(r=e,n=r.ResourceTimingCompression);var i={};i.HOSTNAMES_REVERSED=!0,i.INITIATOR_TYPES={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7,beacon:8,fetch:9,iframe:"a",subdocument:"a",body:"b",input:"c",frame:"a",object:"d",video:"e",audio:"f",source:"g",track:"h",embed:"i",eventsource:"j",navigation:6},i.DEFAULT_XSS_BREAK_WORDS=[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],i.XSS_BREAK_DELIM="\n",i.DEFAULT_URL_LIMIT=500,i.SPECIAL_DATA_PREFIX="*",i.SPECIAL_DATA_DIMENSION_TYPE="0",i.SPECIAL_DATA_SIZE_TYPE="1",i.SPECIAL_DATA_SCRIPT_TYPE="2",i.SPECIAL_DATA_SCRIPT_ASYNC_ATTR=1,i.SPECIAL_DATA_SCRIPT_DEFER_ATTR=2,i.SPECIAL_DATA_SCRIPT_LOCAT_ATTR=4,i.SPECIAL_DATA_SERVERTIMING_TYPE="3",i.SPECIAL_DATA_LINK_ATTR_TYPE="4",i.SPECIAL_DATA_NAMESPACED_TYPE="5",i.SPECIAL_DATA_SERVICE_WORKER_TYPE="6",i.REL_TYPES={prefetch:1,preload:2,prerender:3,stylesheet:4},i.HOSTNAME_REGEX=/^(https?:\/\/)([^\/]+)(.*)/,i.trimUrls=[],i.xssBreakWords=i.DEFAULT_XSS_BREAK_WORDS,i.noConflict=function(){return r.ResourceTimingCompression=n,i},i.roundUpTiming=function(e){return"number"!=typeof e&&(e=0),Math.ceil(e?e:0)},i.convertToTrie=function(e){var t,r,n,o,a,s,c,d,u={};for(t in e)if(e.hasOwnProperty(t)){for(r=t,n=0;n<this.xssBreakWords.length;n++)r=r.replace(this.xssBreakWords[n],"$1"+i.XSS_BREAK_DELIM+"$2");for(o=e[t],a=r.split(""),c=u,n=0;n<a.length;n++)s=a[n],d=c[s],"undefined"==typeof d?c=c[s]=n===a.length-1?o:{}:"string"==typeof d?c=c[s]={"|":d}:n===a.length-1?c[s]["|"]=o:c=c[s]}return u},i.optimizeTrie=function(e,t){var r,n,o,a=0,s=[];for(r in e)e.hasOwnProperty(r)&&s.push(r);for(var c=0;c<s.length;c++)r=s[c],"object"==typeof e[r]&&(n=this.optimizeTrie(e[r],!1),n&&(delete e[r],r===i.XSS_BREAK_DELIM?(r=n.name,a++):r+=n.name,e[r]=n.value)),a++;return 1===a?t?(o={},o[r]=e[r],o):{name:r,value:e[r]}:!!t&&e},i.trimTiming=function(e,t){"number"!=typeof e&&(e=0),"number"!=typeof t&&(t=0);var r=Math.round(e?e:0),n=Math.round(t?t:0);return 0===r?0:r-n},i.getNavStartTime=function(e){var t,r=0;if(!e)return r;try{t=e.location&&e.location.href,"performance"in e&&e.performance&&e.performance.timing&&e.performance.timing.navigationStart&&(r=e.performance.timing.navigationStart)}catch(e){}return r},i.findPerformanceEntriesForFrame=function(e,r,n,i){var o,a,s,c,d,u,m,f,S,p,T=[],E={},g={};if("undefined"==typeof r&&(r=!0),"undefined"==typeof n&&(n=0),"undefined"==typeof i&&(i=0),i>10)return T;try{if(s=this.getNavStartTime(e),p=e.document.createElement("a"),t(p,g,"script"),t(p,E,"link"),e.frames)for(o=0;o<e.frames.length;o++)c=this.getNavStartTime(e.frames[o]),d=0,c>s&&(d=n+(c-s)),T=T.concat(this.findPerformanceEntriesForFrame(e.frames[o],!1,d,++i));try{if(f=e.location&&e.location.href,!("performance"in e&&e.performance&&e.performance.getEntriesByType))return T}catch(e){return T}r&&(a=e.performance.getEntriesByType("navigation"),a&&1===a.length?(u=a[0],T.push({name:e.location.href,startTime:0,initiatorType:"html",redirectStart:u.redirectStart,redirectEnd:u.redirectEnd,fetchStart:u.fetchStart,domainLookupStart:u.domainLookupStart,domainLookupEnd:u.domainLookupEnd,connectStart:u.connectStart,secureConnectionStart:u.secureConnectionStart,connectEnd:u.connectEnd,requestStart:u.requestStart,responseStart:u.responseStart,responseEnd:u.responseEnd,serverTiming:u.serverTiming||[]})):e.performance.timing&&(m=e.performance.timing,0!==m.navigationStart&&m.responseEnd<=m.navigationStart+36e5&&T.push({name:e.location.href,startTime:0,initiatorType:"html",redirectStart:m.redirectStart?m.redirectStart-m.navigationStart:0,redirectEnd:m.redirectEnd?m.redirectEnd-m.navigationStart:0,fetchStart:m.fetchStart?m.fetchStart-m.navigationStart:0,domainLookupStart:m.domainLookupStart?m.domainLookupStart-m.navigationStart:0,domainLookupEnd:m.domainLookupEnd?m.domainLookupEnd-m.navigationStart:0,connectStart:m.connectStart?m.connectStart-m.navigationStart:0,secureConnectionStart:m.secureConnectionStart?m.secureConnectionStart-m.navigationStart:0,connectEnd:m.connectEnd?m.connectEnd-m.navigationStart:0,requestStart:m.requestStart?m.requestStart-m.navigationStart:0,responseStart:m.responseStart?m.responseStart-m.navigationStart:0,responseEnd:m.responseEnd?m.responseEnd-m.navigationStart:0})));var A=e.performance.getEntriesByType("resource"),h=[];for(o=0;A&&o<A.length;o++)m=A[o],S={name:m.name,initiatorType:m.initiatorType,startTime:m.startTime+n,redirectStart:m.redirectStart?m.redirectStart+n:0,redirectEnd:m.redirectEnd?m.redirectEnd+n:0,fetchStart:m.fetchStart?m.fetchStart+n:0,domainLookupStart:m.domainLookupStart?m.domainLookupStart+n:0,domainLookupEnd:m.domainLookupEnd?m.domainLookupEnd+n:0,connectStart:m.connectStart?m.connectStart+n:0,secureConnectionStart:m.secureConnectionStart?m.secureConnectionStart+n:0,connectEnd:m.connectEnd?m.connectEnd+n:0,requestStart:m.requestStart?m.requestStart+n:0,responseStart:m.responseStart?m.responseStart+n:0,responseEnd:m.responseEnd?m.responseEnd+n:0},(m.encodedBodySize||m.decodedBodySize||m.transferSize)&&(S.encodedBodySize=m.encodedBodySize,S.decodedBodySize=m.decodedBodySize,S.transferSize=m.transferSize),m.serverTiming&&m.serverTiming.length&&(S.serverTiming=m.serverTiming),this.updateScriptFlags(g,m,S),this.updateLinkFlags(E,m,S),h.push(S);T=T.concat(h)}catch(e){return T}return T},i.updateScriptFlags=function(e,t,r){if(("script"===t.initiatorType||"link"===t.initiatorType)&&e[t.name]){var n=e[t.name];for(r.scriptAttrs=(n.async?i.SPECIAL_DATA_SCRIPT_ASYNC_ATTR:0)|(n.defer?i.SPECIAL_DATA_SCRIPT_DEFER_ATTR:0);1===n.nodeType&&"BODY"!==n.nodeName;)n=n.parentNode;r.scriptAttrs|="BODY"===n.nodeName?i.SPECIAL_DATA_SCRIPT_LOCAT_ATTR:0}},i.updateLinkFlags=function(e,t,r){"link"===t.initiatorType&&e[t.name]&&e[t.name].rel.split(/[\u0009\u000A\u000C\u000D\u0020]+/).find(function(e){return e=e.toLowerCase(),!!i.REL_TYPES[e]&&(r.linkAttrs=i.REL_TYPES[e],!0)})},i.toBase36=function(e){return"number"==typeof e&&0!==e?e.toString(36):"string"==typeof e?e:""},i.getVisibleEntries=function(t){if(!t)return{};var r,n,i=["img","iframe","image"],o={},a=t.document,s=a.createElement("A");return r=void 0!==t.pageXOffset?t.pageXOffset:(a.documentElement||a.body.parentNode||a.body).scrollLeft,n=void 0!==t.pageYOffset?t.pageYOffset:(a.documentElement||a.body.parentNode||a.body).scrollTop,i.forEach(function(t){var i,c,d,u,m=a.getElementsByTagName(t);for(c=0;c<m.length;c++)if(i=m[c],i&&(u=i.currentSrc||i.src||"function"==typeof i.getAttribute&&i.getAttribute("src")||i.getAttribute("xlink:href"),s.href=u,u=s.href,u&&!o[u]&&(d=i.getBoundingClientRect(),(d.height||i.offsetHeight)&&(d.width||i.offsetWidth)))){if(o[u]=[d.height||i.offsetHeight,d.width||i.offsetWidth,Math.round(d.top+n),Math.round(d.left+r)],!i.naturalHeight&&!i.naturalWidth)continue;var f,S,p;i.currentSrc&&(i.srcset||i.parentNode&&i.parentNode.nodeName&&"PICTURE"===i.parentNode.nodeName.toUpperCase())?(f=i.isConnected?i.ownerDocument.createElement("IMG"):new e.Image,f.src=u):f=i,S=f.naturalHeight||i.naturalHeight,p=f.naturalWidth||i.naturalWidth,!S&&!p||o[u][0]===S&&o[u][1]===p||o[u].push(S,p)}}),o},i.inArray=function(e,t){var r;if("undefined"==typeof e||"undefined"==typeof t||!t.length)return!1;for(r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},i.getFilteredResourceTiming=function(e,t,r,n){var o,a,s=this.findPerformanceEntriesForFrame(e,!0,0,0),c=this.getNavStartTime(e),d={};if(!s||!s.length)return{entries:[]};var u=[];for(o=0;o<s.length;o++)if(a=s[o],0!==a.name.indexOf("about:")&&0!==a.name.indexOf("javascript:")&&!(t&&c+a.startTime<t)){if(r&&c+a.startTime>r)break;("undefined"==typeof n||"*"===n||!n.length||a.initiatorType&&this.inArray(a.initiatorType,n))&&(i.accumulateServerTimingEntries(d,a.serverTiming),u.push(a))}var m=i.compressServerTiming(d);return{entries:u,serverTiming:{lookup:m,indexed:i.indexServerTiming(m)}}},i.compressSize=function(e){var t,r,n,i;return e.encodedBodySize||e.decodedBodySize||e.transferSize?(t=e.transferSize,r=e.encodedBodySize,n=e.decodedBodySize,i=[r,t?t-r:"_",n-r],i.map(this.toBase36).join(",").replace(/,+$/,"")):""},i.cleanupURL=function(e,t){var r;return e&&"[object Array]"!==Object.prototype.toString.call(e)?("undefined"!=typeof t&&e&&e.length>t&&(r=e.indexOf("?"),e=r!==-1&&r<t?e.substr(0,r)+"?...":e.substr(0,t-3)+"..."),e):""},i.trimUrl=function(e,t){var r,n,o;if(e&&t)for(r=0;r<t.length;r++)if(o=t[r],"string"==typeof o){if(n=e.indexOf(o),n!==-1){e=e.substr(0,n+o.length)+"...";break}}else o instanceof RegExp&&o.test(e)&&(e=e.replace(o,"$1")+"...");return this.cleanupURL(e,i.DEFAULT_URL_LIMIT)},i.getResourceTiming=function(t,r,n,o){"undefined"==typeof t&&(t=e);var a=i.getFilteredResourceTiming(t,r,n),s=a.entries,c=a.serverTiming;return s&&s.length?i.compressResourceTiming(t,s,c,o):{}},i.compressResourceTiming=function(e,t,r,n){var o,a,s,c,d,u,m={},f={};for(n||(f=this.getVisibleEntries(e)),o=0;o<t.length;o++){a=t[o],s=this.INITIATOR_TYPES[a.initiatorType],"undefined"==typeof s&&(s=0),u=s+[this.trimTiming(a.startTime,0),this.trimTiming(a.responseEnd,a.startTime),this.trimTiming(a.responseStart,a.startTime),this.trimTiming(a.requestStart,a.startTime),this.trimTiming(a.connectEnd,a.startTime),this.trimTiming(a.secureConnectionStart,a.startTime),this.trimTiming(a.connectStart,a.startTime),this.trimTiming(a.domainLookupEnd,a.startTime),this.trimTiming(a.domainLookupStart,a.startTime),this.trimTiming(a.redirectEnd,a.startTime),this.trimTiming(a.redirectStart,a.startTime)].map(this.toBase36).join(",").replace(/,+$/,"");var S=this.compressSize(a);if(""!==S&&(u+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_SIZE_TYPE+S),a.hasOwnProperty("scriptAttrs")&&(u+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_SCRIPT_TYPE+a.scriptAttrs),a.hasOwnProperty("linkAttrs")&&(u+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_LINK_ATTR_TYPE+a.linkAttrs),a.serverTiming&&a.serverTiming.length&&(u+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_SERVERTIMING_TYPE+a.serverTiming.reduce(function(e,t,n){var o=String(t.duration);"0."===o.substring(0,2)&&(o=o.substring(1));var a=i.identifyServerTimingEntry(r.indexed[t.name].index,r.indexed[t.name].descriptions[t.description]);return e+=(n>0?",":"")+o+a},"")),a.workerStart&&"number"==typeof a.workerStart&&0!==a.workerStart){var p=i.roundUpTiming(a.workerStart),T=this.trimTiming(p,a.startTime);u+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_SERVICE_WORKER_TYPE+this.toBase36(T)}if(d=c=this.trimUrl(a.name,this.trimUrls),i.HOSTNAMES_REVERSED&&(d=this.reverseHostname(c)),a.hasOwnProperty("_data")){var E="";for(var g in a._data)a._data.hasOwnProperty(g)&&(E+=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_NAMESPACED_TYPE+g+":"+a._data[g]);"undefined"==typeof m[c]?m[c]=u+E:m[c]+=E}else void 0!==m[d]?m[d]+="|"+u:void 0!==f[c]?m[d]=i.SPECIAL_DATA_PREFIX+i.SPECIAL_DATA_DIMENSION_TYPE+f[c].map(this.toBase36).join(",").replace(/,+$/,"")+"|"+u:m[d]=u}return{restiming:this.optimizeTrie(this.convertToTrie(m),!0),servertiming:r.lookup}},i.reverseHostname=function(e){return e.replace(i.HOSTNAME_REGEX,function(e,t,r,n){return t+i.reverseString(r)+n})},i.reverseString=function(e){for(var t=e.length,r="";t--;)r+=e[t];return r},i.accumulateServerTimingEntries=function(e,t){(t||[]).forEach(function(t){"undefined"==typeof e[t.name]&&(e[t.name]={count:0,counts:{}});var r=e[t.name];r.counts[t.description]=r.counts[t.description]||0,r.counts[t.description]++,r.count++})},i.compressServerTiming=function(e){return Object.keys(e).sort(function(t,r){return e[r].count-e[t].count}).reduce(function(t,r){var n=Object.keys(e[r].counts).sort(function(t,n){return e[r].counts[n]-e[r].counts[t]});return t.push(1===n.length&&""===n[0]?r:[r].concat(n)),t},[])},i.indexServerTiming=function(e){return e.reduce(function(e,t,r){var n,i;return Array.isArray(t)?(n=t[0],i=t.slice(1).reduce(function(e,t,r){return e[t]=r,e},{})):(n=t,i={"":0}),e[n]={index:r,descriptions:i},e},{})},i.identifyServerTimingEntry=function(e,t){var r="";return e&&(r+=e),t&&(r+="."+t),r.length&&(r=":"+r),r},"function"==typeof define&&define.amd?define([],function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:"undefined"!=typeof r&&(r.ResourceTimingCompression=i)}("undefined"!=typeof window?window:void 0);