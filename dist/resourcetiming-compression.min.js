!function(t){"use strict";var e,r;"undefined"!=typeof t&&(e=t,r=e.ResourceTimingCompression);var n={};n.noConflict=function(){return e.ResourceTimingCompression=r,n},n.INITIATOR_TYPES={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7};var i=[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],o="\n",a=500,s="*",c="0",d="1";n.trimUrls=[],n.xssBreakWords=i,n.convertToTrie=function(t){var e,r,n,i,a,s,c,d,f={};for(e in t)if(t.hasOwnProperty(e)){for(r=e,n=0;n<this.xssBreakWords.length;n++)r=r.replace(this.xssBreakWords[n],"$1"+o+"$2");if(t.hasOwnProperty(e))for(i=t[e],a=r.split(""),c=f,n=0;n<a.length;n++)s=a[n],d=c[s],"undefined"==typeof d?c=c[s]=n===a.length-1?i:{}:"string"==typeof d?c=c[s]={"|":d}:n===a.length-1?c[s]["|"]=i:c=c[s]}return f},n.optimizeTrie=function(t,e){var r,n,i,a=0,s=[];for(r in t)t.hasOwnProperty(r)&&s.push(r);for(var c=0;c<s.length;c++)r=s[c],"object"==typeof t[r]&&(n=this.optimizeTrie(t[r],!1),n&&(delete t[r],r===o?(r=n.name,a++):r+=n.name,t[r]=n.value)),a++;return 1===a?e?(i={},i[r]=t[r],i):{name:r,value:t[r]}:!!e&&t},n.trimTiming=function(t,e){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0);var r=Math.round(t?t:0),n=Math.round(e?e:0);return 0===r?0:r-n},n.getNavStartTime=function(t){var e,r=0;if(!t)return r;try{e=t.location&&t.location.href,"performance"in t&&t.performance&&t.performance.timing&&t.performance.timing.navigationStart&&(r=t.performance.timing.navigationStart)}catch(t){}return r},n.findPerformanceEntriesForFrame=function(t,e,r,n){var i,o,a,s,c,d,f,m,u,p=[];if("undefined"==typeof e&&(e=!0),"undefined"==typeof r&&(r=0),"undefined"==typeof n&&(n=0),n>10)return p;try{if(a=this.getNavStartTime(t),t.frames)for(i=0;i<t.frames.length;i++)s=this.getNavStartTime(t.frames[i]),c=0,s>a&&(c=r+(s-a)),p=p.concat(this.findPerformanceEntriesForFrame(t.frames[i],!1,c,++n));try{if(m=t.location&&t.location.href,!("performance"in t&&t.performance&&t.performance.getEntriesByType))return p}catch(t){return p}e&&(o=t.performance.getEntriesByType("navigation"),o&&1===o.length?(d=o[0],p.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:d.redirectStart,redirectEnd:d.redirectEnd,fetchStart:d.fetchStart,domainLookupStart:d.domainLookupStart,domainLookupEnd:d.domainLookupEnd,connectStart:d.connectStart,secureConnectionStart:d.secureConnectionStart,connectEnd:d.connectEnd,requestStart:d.requestStart,responseStart:d.responseStart,responseEnd:d.responseEnd})):t.performance.timing&&(f=t.performance.timing,0!==f.navigationStart&&f.responseEnd<=f.navigationStart+36e5&&p.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:f.redirectStart?f.redirectStart-f.navigationStart:0,redirectEnd:f.redirectEnd?f.redirectEnd-f.navigationStart:0,fetchStart:f.fetchStart?f.fetchStart-f.navigationStart:0,domainLookupStart:f.domainLookupStart?f.domainLookupStart-f.navigationStart:0,domainLookupEnd:f.domainLookupEnd?f.domainLookupEnd-f.navigationStart:0,connectStart:f.connectStart?f.connectStart-f.navigationStart:0,secureConnectionStart:f.secureConnectionStart?f.secureConnectionStart-f.navigationStart:0,connectEnd:f.connectEnd?f.connectEnd-f.navigationStart:0,requestStart:f.requestStart?f.requestStart-f.navigationStart:0,responseStart:f.responseStart?f.responseStart-f.navigationStart:0,responseEnd:f.responseEnd?f.responseEnd-f.navigationStart:0})));var S=t.performance.getEntriesByType("resource"),g=[];for(i=0;S&&i<S.length;i++)f=S[i],u={name:f.name,initiatorType:f.initiatorType,startTime:f.startTime+r,redirectStart:f.redirectStart?f.redirectStart+r:0,redirectEnd:f.redirectEnd?f.redirectEnd+r:0,fetchStart:f.fetchStart?f.fetchStart+r:0,domainLookupStart:f.domainLookupStart?f.domainLookupStart+r:0,domainLookupEnd:f.domainLookupEnd?f.domainLookupEnd+r:0,connectStart:f.connectStart?f.connectStart+r:0,secureConnectionStart:f.secureConnectionStart?f.secureConnectionStart+r:0,connectEnd:f.connectEnd?f.connectEnd+r:0,requestStart:f.requestStart?f.requestStart+r:0,responseStart:f.responseStart?f.responseStart+r:0,responseEnd:f.responseEnd?f.responseEnd+r:0},(f.encodedBodySize||f.decodedBodySize||f.transferSize)&&(u.encodedBodySize=f.encodedBodySize,u.decodedBodySize=f.decodedBodySize,u.transferSize=f.transferSize),g.push(u);p=p.concat(g)}catch(t){return p}return p},n.toBase36=function(t){return"number"==typeof t&&0!==t?t.toString(36):"string"==typeof t?t:""},n.getVisibleEntries=function(t){var e,r,n=["img","iframe","image"],i={},o=t.document,a=o.createElement("A");return e=void 0!==t.pageXOffset?t.pageXOffset:(o.documentElement||o.body.parentNode||o.body).scrollLeft,r=void 0!==t.pageYOffset?t.pageYOffset:(o.documentElement||o.body.parentNode||o.body).scrollTop,n.forEach(function(t){var n,s,c,d,f=o.getElementsByTagName(t);for(s=0;s<f.length;s++)n=f[s],n&&(d=n.src||n.getAttribute("src")||n.getAttribute("xlink:href"),a.href=d,d=a.href,d&&!i[d]&&(c=n.getBoundingClientRect(),(c.height||n.offsetHeight)&&(c.width||n.offsetWidth)&&(i[d]=[c.height||n.offsetHeight,c.width||n.offsetWidth,Math.round(c.top+r),Math.round(c.left+e)])))}),i},n.inArray=function(t,e){var r;if("undefined"==typeof t||"undefined"==typeof e||!e.length)return!1;for(r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},n.getFilteredResourceTiming=function(t,e,r,n){var i,o,a=this.findPerformanceEntriesForFrame(t,!0,0),s=this.getNavStartTime(t);if(!a||!a.length)return[];var c=[];for(i=0;i<a.length;i++)if(o=a[i],0!==o.name.indexOf("about:")&&0!==o.name.indexOf("javascript:")&&!(e&&s+o.startTime<e)){if(r&&s+o.startTime>r)break;("undefined"==typeof n||"*"===n||!n.length||o.initiatorType&&this.inArray(o.initiatorType,n))&&c.push(o)}return c},n.compressSize=function(t){var e,r,n,i;return t.encodedBodySize||t.decodedBodySize||t.transferSize?(e=t.transferSize,r=t.encodedBodySize,n=t.decodedBodySize,i=[r,e?e-r:"_",n?n-r:0],i.map(this.toBase36).join(",").replace(/,+$/,"")):""},n.cleanupURL=function(t,e){var r;return t&&"[object Array]"!==Object.prototype.toString.call(t)?("undefined"!=typeof e&&t&&t.length>e&&(r=t.indexOf("?"),t=r!==-1&&r<e?t.substr(0,r)+"?...":t.substr(0,e-3)+"..."),t):""},n.trimUrl=function(t,e){var r,n,i;if(t&&e)for(r=0;r<e.length;r++)if(i=e[r],"string"==typeof i){if(n=t.indexOf(i),n!==-1){t=t.substr(0,n+i.length)+"...";break}}else i instanceof RegExp&&i.test(t)&&(t=t.replace(i,"$1")+"...");return this.cleanupURL(t,a)},n.getResourceTiming=function(e,r,i){"undefined"==typeof e&&(e=t);var o=n.getFilteredResourceTiming(e,r,i);return o&&o.length?n.compressResourceTiming(e,o):{}},n.compressResourceTiming=function(t,e){var r,n,i,o,a,f={},m={};for(m=this.getVisibleEntries(t),r=0;r<e.length;r++){n=e[r],i=this.INITIATOR_TYPES[n.initiatorType],"undefined"==typeof i&&(i=0),a=i+[this.trimTiming(n.startTime,0),this.trimTiming(n.responseEnd,n.startTime),this.trimTiming(n.responseStart,n.startTime),this.trimTiming(n.requestStart,n.startTime),this.trimTiming(n.connectEnd,n.startTime),this.trimTiming(n.secureConnectionStart,n.startTime),this.trimTiming(n.connectStart,n.startTime),this.trimTiming(n.domainLookupEnd,n.startTime),this.trimTiming(n.domainLookupStart,n.startTime),this.trimTiming(n.redirectEnd,n.startTime),this.trimTiming(n.redirectStart,n.startTime)].map(this.toBase36).join(",").replace(/,+$/,"");var u=this.compressSize(n);""!==u&&(a+=s+d+u),o=this.trimUrl(n.name,this.trimUrls),void 0!==f[o]?f[o]+="|"+a:void 0!==m[o]?f[o]=s+c+m[o].map(this.toBase36).join(",").replace(/,+$/,"")+"|"+a:f[o]=a}return this.optimizeTrie(this.convertToTrie(f),!0)},"function"==typeof define&&define.amd?define([],function(){return n}):"undefined"!=typeof module&&module.exports?module.exports=n:"undefined"!=typeof e&&(e.ResourceTimingCompression=n)}("undefined"!=typeof window?window:void 0);